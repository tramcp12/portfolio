# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

---

## Project Overview

**Tr·∫°m CP12** is a single-page static website for a homestay accommodation in ƒê√† L·∫°t, Vietnam. Deployed as a standalone GitHub Pages site.

- **Language:** Vietnamese (HTML `lang="vi"`) with mixed Vietnamese/English content
- **Stack:** Vanilla HTML5, CSS3, and JavaScript (no frameworks, no runtime bundler; `build.js` dev-only assembler)
- **Hosting:** GitHub Pages ‚Äî `tramcp12.github.io/portfolio/`
- **External Dependencies:** Google Fonts only (runtime, non-blocking); `html-validate` (dev-only)

---

## Repository Structure

```
portfolio/
‚îú‚îÄ‚îÄ src/                         # SOURCE FILES ‚Äî edit these
‚îÇ   ‚îú‚îÄ‚îÄ core/                    # Shared CSS (tokens, reset, buttons, animations‚Ä¶)
‚îÇ   ‚îú‚îÄ‚îÄ layout/                  # Nav, footer, modal, dots ‚Äî CSS + HTML partials
‚îÇ   ‚îú‚îÄ‚îÄ features/                # One folder per section domain
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ home/   video/   rooms/   explore/   about/   journal/   cta/
‚îÇ   ‚îú‚îÄ‚îÄ shared/                  # scroll-reveal.js (IIFE 3)
‚îÇ   ‚îî‚îÄ‚îÄ data/                    # rooms.json ¬∑ travel.json ¬∑ journal.json
‚îÇ
‚îú‚îÄ‚îÄ build.js             # Source assembler ‚Äî run `npm run build`
‚îÇ
‚îÇ
‚îú‚îÄ‚îÄ index.html           # ‚Üê GENERATED by build.js ‚Äî do not edit
‚îú‚îÄ‚îÄ cp12.css             # ‚Üê GENERATED by build.js ‚Äî do not edit
‚îú‚îÄ‚îÄ cp12.js              # ‚Üê GENERATED by build.js ‚Äî do not edit
‚îÇ
‚îú‚îÄ‚îÄ static/              # Static assets (Phase 6)
‚îÇ   ‚îú‚îÄ‚îÄ img/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ travel/      # Self-hosted travel images (6 JPEGs)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ lake-run.jpg
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ flower-garden.jpg
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ langbiang.jpg     ‚Üê og:image / twitter:image / JSON-LD image
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ night-market.jpg
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ hill-loop.jpg
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ zen-monastery.jpg
‚îÇ   ‚îú‚îÄ‚îÄ docs/            # Downloadable documents (.gitkeep placeholder)
‚îÇ   ‚îî‚îÄ‚îÄ video/           # Future video assets (.gitkeep placeholder)
‚îÇ
‚îú‚îÄ‚îÄ favicon.svg          # Browser favicon (kept at root for convention)
‚îÇ
‚îú‚îÄ‚îÄ img/                 # LEGACY ‚Äî kept until production URLs verified post-deploy
‚îÇ                        # Delete this folder in a SEPARATE commit after deployment
‚îÇ
‚îú‚îÄ‚îÄ validate.js          # Architectural invariant checker (12 rules)
‚îú‚îÄ‚îÄ package.json         # Dev tooling
‚îú‚îÄ‚îÄ .gitignore
‚îÇ
‚îú‚îÄ‚îÄ .github/workflows/
‚îÇ   ‚îú‚îÄ‚îÄ ci.yml           # Build + validate + lint on every push/PR
‚îÇ   ‚îî‚îÄ‚îÄ pages.yml        # Auto-deploy to GitHub Pages on main push
‚îÇ
‚îî‚îÄ‚îÄ CLAUDE.md            # This file
```

> **src/ is in Phase 6 (all splits complete, static asset migration done).** CSS, HTML, JS, and data are assembled from `src/` by `build.js`. Room data lives in `src/data/rooms.json` and is injected by the build as `<script id="rooms-data">` for IIFE 1. Travel and journal data live in `src/data/travel.json` / `src/data/journal.json` as reference files (their static HTML partials are retained for SEO). Travel images live in `static/img/travel/` and are referenced by CSS `url("static/img/travel/...")`. `build.js` Phase 6 guard validates all static/img/ references at build time (A-2 invariant).

`cp12.html` is kept in the repo as the original Wix source reference ‚Äî it is **not** served by GitHub Pages. `index.html` is the standalone deployment version.

---

## Development Workflow

### Making Changes

1. **Edit `src/`** for all source changes ‚Äî never edit `index.html`, `cp12.css`, or `cp12.js` directly
   - HTML changes ‚Üí `src/shell-head.html`, `src/layout/*.html.partial`, `src/features/*/*.html.partial`
   - CSS changes ‚Üí `src/core/*.css`, `src/layout/*.css`, `src/features/*/*.css`
   - JS changes ‚Üí `src/features/*/*.js`, `src/shared/scroll-reveal.js`
2. **Run `npm run build`** to regenerate output files
3. **Test locally** by opening `index.html` in a browser
4. **Commit and push** to a feature branch ‚Üí CI runs automatically

### Validation

Install dev dependencies (one-time):
```bash
npm install
```

Run all checks (build + validate + lint):
```bash
npm run build     # assembles outputs, then runs all checks (preferred)
npm run check     # validate + lint against existing output files only
```

Or individually:
```bash
node validate.js          # 11 architectural invariant checks
npx html-validate index.html  # HTML spec compliance
```

> **`index.html`, `cp12.css`, `cp12.js` are build outputs.** Edit `src/` source files, then run `npm run build`. Do not edit the root output files directly.

`validate.js` enforces these invariants ‚Äî **do not break them**:

| Check | File | Rule |
|-------|------|------|
| CSS-1 | `cp12.css` | Font families appear exactly once (Cormorant Garamond, Be Vietnam Pro) |
| CSS-2 | `cp12.css` | Shared button base extracted to `.btn-base` or grouped selector |
| CSS-3 | `cp12.css` | Alpha tokens `--gold-20` and `--pine-dark-90` defined in `:root` |
| A-1 | `cp12.css` | `@media (prefers-reduced-motion: reduce)` guard exists |
| R-1 | `cp12.css` | `@media (max-width: 768px)` tablet breakpoint exists |
| JS-1 | `cp12.js` | `try { } catch (e) { }` init guard exists |
| JS-3 | `cp12.js` | `var cachedNav = null` nav caching pattern exists |
| P-1 | `index.html` | No `<img>` tags ‚Äî all images are CSS `background` properties |
| H-1 | `index.html` | `og:image` meta tag present for social sharing |

### Manual Testing Checklist

- Check all sections render correctly
- Test responsive layout at 768px and 480px widths
- Verify scroll-triggered animations
- Test modal open/close (click play button, Escape key, backdrop click)
- Test hamburger menu on mobile viewport
- Test travel filter tabs (All / Running / Food / Nature)
- Test keyboard navigation (PageDown, Shift+ArrowDown)
- Run Lighthouse or axe DevTools accessibility audit

### Branch Strategy

Work on `claude/...` feature branches; never commit directly to `main`.

### Deployment

Push to `main` ‚Üí `pages.yml` deploys to GitHub Pages automatically (~30 seconds).

One-time GitHub repo settings:
1. **Settings ‚Üí Pages ‚Üí Source**: Select **GitHub Actions**
2. **Settings ‚Üí Branches**: Require CI status check to pass before merge on `main`

---

## CSS Source Architecture (`src/`)

Edit CSS in `src/`, then run `npm run build` to regenerate `cp12.css`.

### Cascade Order (concat sequence in build.js)
```
src/core/tokens.css           ‚Üê :root CSS variables (CSS-1/CSS-3 invariants live here)
src/core/reset.css            ‚Üê #cp12-wrap base wrapper + universal resets
src/core/accessibility.css    ‚Üê .sr-only, .skip-nav, :focus-visible
src/layout/nav.css            ‚Üê .cp12-main-nav, .nav-logo, .nav-links, scrolled states
src/layout/nav-mobile.css     ‚Üê .nav-mobile-overlay panel
src/layout/dots.css           ‚Üê #cp12-dots, .dot, tooltip
src/layout/next-btn.css       ‚Üê #cp12-next-btn floating button
src/core/buttons.css          ‚Üê .btn-primary/.btn-gold/.btn-outline/.btn-ghost (CSS-2)
src/core/section-labels.css   ‚Üê .section-label variants
src/core/animations.css       ‚Üê @keyframes + .cp12-reveal + prefers-reduced-motion (A-1)
src/features/home/home.css    ‚Üê .hero + sect-home animation sigs + hero responsive
src/features/video/video.css  ‚Üê .video-section + sect-video
src/features/rooms/rooms.css  ‚Üê .room-card, r1‚Äìr4 gradients + sect-rooms
src/features/explore/explore.css ‚Üê .travel-card, ti1‚Äìti6 gradients + sect-explore
src/features/about/about.css  ‚Üê .about-section + sect-about
src/features/journal/journal.css ‚Üê .blog-card, bi1‚Äìbi3 gradients + sect-journal
src/features/cta/cta.css      ‚Üê .cta-section + sect-book
src/layout/footer.css         ‚Üê footer + social links
src/layout/modal.css          ‚Üê .modal overlay
src/core/responsive-sentinel.css ‚Üê cross-cutting @media (max-width: 768px) (R-1)
src/core/supports.css         ‚Üê @supports backdrop-filter (must be last)
```

### CSS Authoring Rules
- **Never** write CSS directly in `cp12.css` ‚Äî it is overwritten on every build
- Section animation signatures (`.sect-X .card { opacity: 0 }` + `.sect-X.animated .card { animation: ... }`) belong **at the bottom** of each feature's CSS file
- Font family strings may only appear in `src/core/tokens.css` (CSS-1 build guard enforces this)
- All colours must use CSS tokens ‚Äî no hard-coded hex values

## JavaScript Architecture

`cp12.js` is **generated** by `build.js` from four IIFE source files in DOM order. Each IIFE uses independent local variables ‚Äî do not merge them (both IIFE 0 and IIFE 3 declare `var wrap`; merging would create a collision).

| IIFE | Source file | Responsibility |
|------|-------------|---------------|
| 0 | `src/features/rooms/rooms.js` | Rooms renderer ‚Äî reads `#rooms-data` inline JSON, builds `#rooms-grid` with `escHtml()` XSS guard |
| 1 | `src/features/video/video.js` | Hero play button + video frame click/keydown handlers |
| 2 | `src/features/explore/explore.js` | Travel filter tabs (`data-filter`, `aria-selected`, live count) |
| 3 | `src/shared/scroll-reveal.js` | Modal, mobile nav, IO reveal, scroll RAF, dot nav, anchor scroll |

`window.cp12OpenModal` is set in IIFE 3 and called (with guard) from IIFE 1. This is intentional ‚Äî the guard `if (window.cp12OpenModal)` is defensive coding, kept for robustness.

### Rooms Renderer (IIFE 0)

Room cards are driven by a `<script id="rooms-data" type="application/json">` element in `index.html`. IIFE 0 parses it and renders into `<div id="rooms-grid">`. All output is XSS-safe via `escHtml()`. Do not use raw `innerHTML` with untrusted data in this IIFE.

---

## HTML Structure

Seven sections inside `#cp12-wrap`, tracked by dot-nav via `data-section` and JS `querySelectorAll`:

```
#home     ‚Äî Hero (two-column, diagonal clip-path)
#video    ‚Äî Welcome film showcase with modal trigger
#rooms    ‚Äî 4 room cards in a grid (rendered by IIFE 0 from #rooms-data JSON)
#explore  ‚Äî Filterable travel guide (Running / Food / Nature)
#about    ‚Äî Two-column brand story
#journal  ‚Äî Blog / journal cards
#cta      ‚Äî Booking call-to-action with contact details
<footer>  ‚Äî Multi-column footer, social links, copyright
```

### `<head>` Meta Tags

| Tag | Purpose |
|-----|---------|
| `og:image`, `og:title`, `og:description` | Open Graph social sharing |
| `twitter:card/title/description/image` | Twitter/X card preview |
| `<link rel="canonical">` | Canonical URL for SEO |
| `<link rel="preconnect" href="https://www.youtube.com">` | YouTube preconnect (faster modal video) |
| `theme-color` | Browser chrome tint (`#2d4a3e`) |

### JSON-LD Structured Data

A `LodgingBusiness` schema.org block lives at the bottom of `<body>` (before `</body>`). It includes address, geo-coordinates, price range, amenities, check-in/out times, and social profile `sameAs` links. Keep this in sync with actual contact details.

---

## CSS Conventions

### Design Tokens

All colours, typography, and spacing are CSS variables on `#cp12-wrap`. **Never hard-code colour values.**

#### Colour Palette

| Token | Value | Usage |
|-------|-------|-------|
| `--cream` | `#f5f0e8` | Primary light background |
| `--warm-white` | `#fdfaf5` | Elevated light surfaces |
| `--pine` | `#2d4a3e` | Primary brand green |
| `--pine-light` | `#3d6357` | Hover states on pine |
| `--pine-dark` | `#1a3028` | Footer, CTA backgrounds |
| `--pine-mid` | `#5c8b7a` | Mid-tone accents |
| `--mist` | `#b8cabd` | Subtle green tints |
| `--earth` | `#8b6347` | Warm brown accent |
| `--terracotta` | `#c4724a` | Vibrant warm accent |
| `--gold` | `#c9a96e` | Highlight/gold accent |
| `--charcoal` | `#2a2522` | Primary dark text |
| `--slate` | `#4a5568` | Secondary text |
| `--slate-light` | `#718096` | Tertiary/muted text |
| `--text-warm` | `#3d3530` | Warm-tinted body text |
| `--slate-blue` | `#2d4a7a` | Badge/info accents |
| `--gold-20` | alpha variant | Defined as token; required by validate.js |
| `--pine-dark-90` | alpha variant | Defined as token; required by validate.js |

#### Typography

| Font | Weights | Used For |
|------|---------|----------|
| Cormorant Garamond | 300, 600, italic 300 | Headings, decorative text |
| Be Vietnam Pro | 300, 400, 500 | Body copy, UI labels |

Each font family must appear **exactly once** in `cp12.css` (validate.js CSS-1 check).

### Naming Conventions

- **Sections:** `.sect-home`, `.sect-rooms`, `.sect-explore`, etc.
- **Components:** `.hero-left`, `.room-card`, `.travel-card`, `.blog-card`
- **Utilities:** `.fade-up`, `.delay-1` through `.delay-5` (delays: 0.15s / 0.3s / 0.45s / 0.6s / 0.75s), `.cp12-reveal`
- **State:** `.active`, `.visible`, `.open`, `.on-dark`, `.on-light`
- **Buttons:** `.btn-primary`, `.btn-outline`, `.btn-ghost`

### Responsive Breakpoints

| Breakpoint | Width | Changes |
|------------|-------|---------|
| Desktop | >900px | Full layout, sidebar dots visible |
| Tablet | ‚â§768px | Single columns, hamburger nav |
| Mobile | ‚â§480px | Stacked layouts, reduced padding |
| Reduced motion | `prefers-reduced-motion` | All animations disabled |

### Z-Index Layers

| Layer | Z-index | Element |
|-------|---------|---------|
| Base content | 1 | Cards, sections |
| Navigation | 100‚Äì1000 | Nav bar (increases on scroll) |
| Mobile nav overlay | 200 | Hamburger menu panel |
| Sidebar UI | 9000 | Dot nav, next-section button |
| Modal | 1000000 | Video modal overlay |

### Layered Card Backgrounds

Room and blog cards use a **3-layer CSS background** pattern:

```css
background:
  linear-gradient(...)   /* 1. Diagonal light shaft / specular highlight */,
  radial-gradient(...)   /* 2. Atmospheric glow */,
  linear-gradient(...);  /* 3. Base gradient */
```

---

## JavaScript Conventions

### Architecture Requirements

The following patterns are enforced by `validate.js` and must be maintained:

- **Error safety:** The main init block must be wrapped in `try { } catch (e) { }`
- **Nav caching:** Nav element must be cached: `var cachedNav = null;` / `if (!cachedNav) { cachedNav = ... }`
- **No `<img>` tags:** All images use CSS `background` properties for performance

### Animation System

Scroll-triggered animations use `IntersectionObserver` (threshold `0.18`) on `.cp12-reveal` elements, which gain `.visible` to trigger CSS keyframe animations.

**Core keyframes:**

| Name | Effect |
|------|--------|
| `cp12fu` | Fade-up (most common) |
| `cp12SlideLeft` / `cp12SlideRight` | Horizontal slide-in |
| `cp12ScaleUp` | Scale from 0.9 with fade |
| `cp12FadeScale` | Smooth scale transition |
| `cp12GlowPulse` | Pulsing box-shadow |
| `cp12BobDown` | Vertical bob (next-button) |

Staggered children use `:nth-child` selectors with increasing `animation-delay`.

### Event Patterns

- **Scroll:** `window.addEventListener('scroll', ...)` ‚Äî nav shadow, dot activation, next-button visibility
- **Keyboard:** `Escape` closes modal; `PageDown` / `Shift+ArrowDown` advance to next section
- **Reveal:** `IntersectionObserver` with `threshold: 0.18`

### Data Attributes Used in JS

| Attribute | Element | Purpose |
|-----------|---------|---------|
| `data-category` | Travel cards | Shown/hidden by filter tabs |
| `data-filter` | Filter tab buttons | Active value (`all`, `running`, `food`, `nature`) |
| `data-label` | Dot nav items | Tooltip text |
| `data-target` | Dot nav items | Section ID to scroll to |
| `data-section` | `<section>` elements | Tracked by scroll for dot activation |

### Rooms Data (IIFE 0)

Room data lives in **`src/data/rooms.json`** and is injected by `build.js` into `index.html` as:
```html
<script id="rooms-data" type="application/json">[‚Ä¶]</script>
```
The script tag is placed at the bottom of `<body>` (after `#cp12-wrap`, before the JSON-LD block). IIFE 0 reads it at runtime via `document.getElementById("rooms-data")`. Each room object shape:
```json
{
  "bgClass": "r1",
  "name": "Ph√≤ng Tr·∫°m ‚Äî The Signature Room",
  "price": "580K",
  "featured": true,
  "desc": "‚Ä¶",
  "meta": [{"icon": "üë§", "text": "2 guests"}],
  "amenities": ["Private Balcony", "WiFi"]
}
```
Rendered into `<div id="rooms-grid" class="rooms-grid">`. All values are escaped through `escHtml()` before insertion.

**To edit rooms**: modify `src/data/rooms.json`, then run `npm run build`.

---

## Accessibility Requirements

- **ARIA:** Keep `aria-label`, `role`, and `aria-live` attributes intact
- **Focus management:** Modal must trap focus on open and restore on close
- **Skip nav:** `.skip-nav` must remain the first interactive element
- **Keyboard:** Modal closes with `Escape`; buttons respond to `Enter` and `Space`
- **Reduced motion:** Respect `@media (prefers-reduced-motion: reduce)`

---

## Key Constraints

- **No JS frameworks** ‚Äî vanilla JS only, no build step
- **npm is dev-only** ‚Äî `html-validate` is a dev tool; no runtime npm dependencies
- **Four IIFEs in `cp12.js`** ‚Äî keep them separate (variable name collisions if merged; IIFE 0 = rooms renderer, IIFE 1 = hero, IIFE 2 = travel tabs, IIFE 3 = modal/nav/scroll)
- **Scope all CSS under `#cp12-wrap`** ‚Äî required for isolation
- **Use `var` in IIFE-scoped code** ‚Äî modern browser APIs (`IntersectionObserver`, `classList`, arrow functions) are fine
- **Images in `static/img/travel/`** ‚Äî all travel card images are self-hosted under `static/`; CSS references use `url("static/img/travel/...")` relative to repo root; do not reintroduce Wix CDN URLs or legacy `img/` paths
- **No `<img>` tags** ‚Äî all images use CSS `background` properties (P-1 invariant)
- **Run `npm run check`** before committing CSS or JS changes

---

## Content Reference

### Rooms

| ID | Name | Price/Night |
|----|------|-------------|
| `r1` | Ph√≤ng Tr·∫°m (Signature Room) | 580,000 VND |
| `r2` | G√≥c Gi√≥ (Breeze Nook) | 450,000 VND |
| `r3` | T·ªï Chim (Birdsong Suite) | 720,000 VND |
| `r4` | Dorm Tr·∫°m (Social Dormitory) | 180,000 VND |

### Contact

- **Email:** `cp12tramdungchill@gmail.com`
- **Phone:** `+84765679228`
- **Address:** 228/6 ƒê∆∞·ªùng Ph√∫ ƒê·ªìng Thi√™n V∆∞∆°ng, Ph∆∞·ªùng 8, ƒê√† L·∫°t, L√¢m ƒê·ªìng, Vi·ªát Nam

### Social Links

Facebook ¬∑ Instagram ¬∑ YouTube ¬∑ TikTok ¬∑ Google Maps

### External Assets

- **Fonts:** Google Fonts CDN (Cormorant Garamond, Be Vietnam Pro) ‚Äî loaded non-blocking via `media="print"` trick
- **Travel images:** Self-hosted in `img/` directory (6 JPEG files)
- **Room/blog card backgrounds:** Pure CSS gradients ‚Äî no image files needed
